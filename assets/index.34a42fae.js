var X=Object.defineProperty;var Y=(i,t,e)=>t in i?X(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var h=(i,t,e)=>(Y(i,typeof t!="symbol"?t+"":t,e),e);const Z=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}};Z();const J=i=>{const t=Math.random()*Math.PI*2;return{y:i*Math.cos(t),x:i*Math.sin(t)}},N={x:0,y:0},E=({x:i,y:t},e)=>({x:i*e,y:t*e}),g=(i,t)=>({x:i.x+t.x,y:i.y+t.y}),C=(i,t)=>({x:i.x-t.x,y:i.y-t.y}),T=({x:i,y:t})=>Math.sqrt(Math.pow(i,2)+Math.pow(t,2)),_=({x:i,y:t})=>{const e=T({x:i,y:t});return e?{x:i/e,y:t/e}:N},b=(i,t)=>T(C(i,t));let u=null;const Q=(i,t)=>{i.onMouseDown=(e,o)=>{const{index:s,node:n}=t.getNodeAtPoint(e);o.button===0?n&&(u={node:s,moved:!1,...C(e,n.position)},i.nodeCanvas.style.cursor="grabbing"):o.button===2&&(n?(t.removeNode(s),i.nodeCanvas.style.cursor="auto"):(t.addNode({type:"source",position:e,radius:15}),i.nodeCanvas.style.cursor="pointer"))},i.onMouseUp=e=>{u&&!u.moved&&t.flipNodeType(u.node),u=null,i.nodeCanvas.style.cursor=t.getNodeAtPoint(e).node?"pointer":"default"},i.onMouseLeave=()=>{u=null,i.nodeCanvas.style.cursor="pointer"},i.onMouseMove=e=>{if(!u){i.nodeCanvas.style.cursor=t.getNodeAtPoint(e).node?"pointer":"default";return}u.moved=!0,t.moveNode(u.node,C(e,u))}};let x={},O;const $=(i,t,e,o)=>{i.onTouchesChange=s=>{const n={};s.forEach(({id:d,...l})=>{let c=x[d];if(c===void 0){const k=t.getNodeAtPoint(l),A={initial:l,callback:setTimeout(()=>{const m=x[d];!m||(m.type==="screen"&&t.addNode({type:"source",position:m.initial,radius:15}),m.type==="node"&&t.removeNode(m.node),x[d]={type:"orphaned",initial:m.initial})},500)};c=k.index===void 0?{type:"screen",latest:l,...A}:{type:"node",node:k.index,relative:C(l,k.node.position),...A}}c.type==="node"&&t.moveNode(c.node,C(l,c.relative)),c.type==="screen"&&(c.latest=l),c.type!=="orphaned"&&b(l,c.initial)>20&&c.callback!==void 0&&(clearTimeout(c.callback),c.callback=void 0),n[d]=c});const a=Object.keys(x).filter(d=>n[Number(d)]===void 0),r=new Date().valueOf();let p=!1;a.forEach(d=>{const l=x[Number(d)];l.type==="screen"&&l.initial.x>l.latest.x+100?o("increase"):l.type==="screen"&&l.initial.x<l.latest.x-100?o("decrease"):l.type==="node"&&l.callback!==void 0?t.flipNodeType(l.node):O&&r-O.time<=1e3&&O.positions.some(c=>b(c,l.initial)<20)&&(p=!0),l.type!=="orphaned"&&l.callback!==void 0&&clearTimeout(l.callback)}),p&&e(),a.length&&(O={time:r,positions:a.map(d=>x[Number(d)].initial)}),x=n}},L=document.getElementById("backdrop"),q=(i,t,e,o,s,n)=>{const a=()=>{o(),L.style.display=e()?"flex":"none",console.log("flip")};$(i,t,a,s),Q(i,t),L.onclick=a,document.onkeydown=r=>{r.code==="Space"&&a(),r.code==="KeyC"&&n(),r.code==="ArrowRight"&&s("increase"),r.code==="ArrowLeft"&&s("decrease")}};class V{constructor(t){h(this,"list");this.list=t}update(t){}getNodeAtPoint(t){const e=this.list.findIndex(o=>b(o.position,t)<o.radius);return e<0?{index:void 0,node:void 0}:{index:e,node:this.list[e]}}addNode(t){this.list.push(t)}removeNode(t){this.list.splice(t,1)}moveNode(t,e){this.list[t].position=e}flipNodeType(t){this.list[t].type=this.list[t].type==="sink"?"source":"sink"}}class tt extends V{constructor(t){super([{position:{x:t.x*.25,y:0},type:"source",radius:15},{position:{x:-t.x*.25,y:0},type:"source",radius:15},{position:{x:0,y:-t.y*.25},type:"sink",radius:15},{position:{x:0,y:t.y*.25},type:"sink",radius:15}])}}class et extends V{constructor(t){super([{position:{x:200,y:0},type:"sink",radius:20},{position:{x:-200,y:0},type:"sink",radius:20},{position:{x:0,y:200},type:"sink",radius:20},{position:{x:0,y:-200},type:"sink",radius:20},{position:{x:0,y:18},type:"source",radius:15},{position:{x:0,y:-18},type:"source",radius:15}])}}class it extends V{constructor(e){const o=Math.min(e.x,e.y)/3,s=[...Array(3)].map((n,a)=>({position:{x:o*Math.sin(Math.PI*2/3*a),y:o*Math.cos(Math.PI*2/3*a)},type:"source",radius:15}));super([...s,{position:{x:0,y:0},type:"sink",radius:20}]);h(this,"dimension");h(this,"time",0);h(this,"originals");this.dimension=o,this.originals=s.map((n,a)=>[a,n])}update(e){this.time+=e,this.originals.forEach(([o,s])=>{s.position={x:this.dimension*Math.sin(Math.PI*2/3*o+this.time*1.5),y:this.dimension*Math.cos(Math.PI*2/3*o+this.time*1.5)}})}removeNode(e){this.originals=this.originals.filter(([o,s])=>s!==this.list[e]),super.removeNode(e)}moveNode(e,o){this.originals=this.originals.filter(([s,n])=>n!==this.list[e]),super.moveNode(e,o)}}class st extends V{constructor(e){const o={position:{x:-e.x*.15,y:0},type:"sink",radius:15},s={position:{x:e.x*.15,y:0},type:"sink",radius:15};super([o,s,{position:{x:0,y:0},type:"source",radius:20}]);h(this,"time",0);h(this,"sinks");h(this,"bounds");this.sinks=[["left",o],["right",s]],this.bounds=e}update(e){this.time+=e,this.sinks.forEach(([o,s])=>{s.position={x:this.bounds.x*.15*(o==="left"?-1:1),y:this.bounds.y*.25*Math.sin(this.time*1.5*(o==="left"?-1:1))}})}removeNode(e){this.sinks=this.sinks.filter(([o,s])=>s!==this.list[e]),super.removeNode(e)}moveNode(e,o){this.sinks=this.sinks.filter(([s,n])=>n!==this.list[e]),super.moveNode(e,o)}}const j=[tt,et,st,it],ot=3e6,nt=.01,R=.002;class at{constructor(t){h(this,"list");h(this,"bounds");this.list=[],this.bounds=t}update(t,e){e.forEach(s=>{var n;if(s.type==="source")for(s.lapsed=((n=s.lapsed)!=null?n:0)+t,s.lapsed>100*R&&(s.lapsed=100*R);s.lapsed>R;){const a=s.radius*(1-Math.random()*.5-.5),r=g(s.position,J(a));this.list.push({position:r,previous:r,velocity:N}),s.lapsed-=R}});const o=[];this.list.forEach((s,n)=>{const a=e.map(p=>{const d=C(p.position,s.position),l=ot/Math.pow(T(d),2),c=p.type==="sink"?1:-1;return E(_(d),Math.min(3e3,l)*c)}).reduce(g,N),r=E(_(s.velocity),-nt*Math.pow(T(s.velocity),2));s.velocity=g(s.velocity,E(g(a,r),t)),s.previous=s.position,s.position=g(s.position,E(s.velocity,t)),(e.some(p=>p.type==="sink"&&T(C(p.position,s.position))<p.radius*.8)||Math.abs(s.position.x)>this.bounds.x/1.5||Math.abs(s.position.y)>this.bounds.y/1.5)&&o.push(n)}),this.list=this.list.filter((s,n)=>!o.includes(n))}}const M="#0a091a",P="#e0e7ff";class lt{constructor(){h(this,"projectileCanvas");h(this,"projectileCtx");h(this,"nodeCanvas");h(this,"nodeCtx");h(this,"VIEWPORT");h(this,"dpr");this.projectileCanvas=document.getElementById("projectile-canvas"),this.projectileCtx=this.projectileCanvas.getContext("2d"),this.nodeCanvas=document.getElementById("node-canvas"),this.nodeCtx=this.nodeCanvas.getContext("2d"),this.VIEWPORT={x:window.innerWidth,y:innerHeight},this.dpr=window.devicePixelRatio||1,this.updateCanvasSizes(),this.clear(),window.onresize=()=>this.resizeCanvas();const t=o=>({x:o.clientX-this.VIEWPORT.x/2,y:o.clientY-this.VIEWPORT.y/2}),e=o=>{o.preventDefault(),this.onTouchesChange(rt(o.targetTouches,this.VIEWPORT))};this.nodeCanvas.onmousedown=o=>this.onMouseDown(t(o),o),this.nodeCanvas.onmousemove=o=>this.onMouseMove(t(o)),this.nodeCanvas.onmouseup=o=>this.onMouseUp(t(o)),this.nodeCanvas.onmouseleave=()=>this.onMouseLeave(),this.nodeCanvas.oncontextmenu=()=>!1,this.nodeCanvas.ontouchstart=e,this.nodeCanvas.ontouchmove=e,this.nodeCanvas.ontouchend=e}updateCanvasSizes(){D(this.projectileCanvas,this.VIEWPORT,this.dpr),this.projectileCtx.scale(this.dpr,this.dpr),D(this.nodeCanvas,this.VIEWPORT,this.dpr),this.nodeCtx.scale(this.dpr,this.dpr)}resizeCanvas(){this.VIEWPORT.x=window.innerWidth,this.VIEWPORT.y=window.innerHeight;const t=F(this.projectileCanvas,this.dpr),e=F(this.projectileCanvas,this.dpr);this.updateCanvasSizes(),this.projectileCtx.drawImage(t,0,0),this.projectileCtx.drawImage(e,0,0)}updateCanvasFrame(t,e,o){const s=1-Math.pow(.01,t);this.projectileCtx.fillStyle=M,this.projectileCtx.globalAlpha=s,this.projectileCtx.rect(0,0,this.VIEWPORT.x,this.VIEWPORT.y),this.projectileCtx.fill(),this.projectileCtx.globalAlpha=1,this.projectileCtx.fillStyle=P,this.projectileCtx.strokeStyle=P,this.projectileCtx.lineWidth=4,o.forEach(({position:n,previous:a})=>{this.projectileCtx.beginPath(),this.projectileCtx.arc(n.x+this.VIEWPORT.x/2,n.y+this.VIEWPORT.y/2,2,0,2*Math.PI),this.projectileCtx.fill(),this.projectileCtx.closePath(),this.projectileCtx.beginPath(),this.projectileCtx.moveTo(a.x+this.VIEWPORT.x/2,a.y+this.VIEWPORT.y/2),this.projectileCtx.lineTo(n.x+this.VIEWPORT.x/2,n.y+this.VIEWPORT.y/2);const r=this.projectileCtx.createLinearGradient(a.x+this.VIEWPORT.x/2,a.y+this.VIEWPORT.y/2,n.x+this.VIEWPORT.x/2,n.y+this.VIEWPORT.y/2);r.addColorStop(1,P),r.addColorStop(0,ct(P,M,s)),this.projectileCtx.strokeStyle=r,this.projectileCtx.stroke()}),this.nodeCtx.clearRect(0,0,this.nodeCanvas.width,this.nodeCanvas.height),this.nodeCtx.fillStyle=M,this.nodeCtx.strokeStyle=P,e.forEach(n=>{this.nodeCtx.beginPath(),this.nodeCtx.arc(n.position.x+this.VIEWPORT.x/2,n.position.y+this.VIEWPORT.y/2,n.radius,0,2*Math.PI),this.nodeCtx.fill(),this.nodeCtx.closePath(),this.nodeCtx.lineWidth=.5,this.nodeCtx.beginPath(),this.nodeCtx.arc(n.position.x+this.VIEWPORT.x/2,n.position.y+this.VIEWPORT.y/2,n.radius,0,2*Math.PI),this.nodeCtx.stroke(),this.nodeCtx.closePath(),this.nodeCtx.beginPath(),this.nodeCtx.lineWidth=4,this.nodeCtx.moveTo(n.position.x+this.VIEWPORT.x/2-6,n.position.y+this.VIEWPORT.y/2),this.nodeCtx.lineTo(n.position.x+this.VIEWPORT.x/2+6,n.position.y+this.VIEWPORT.y/2),n.type==="source"&&(this.nodeCtx.moveTo(n.position.x+this.VIEWPORT.x/2,n.position.y+this.VIEWPORT.y/2+6),this.nodeCtx.lineTo(n.position.x+this.VIEWPORT.x/2,n.position.y+this.VIEWPORT.y/2-6)),this.nodeCtx.stroke(),this.nodeCtx.closePath()})}clear(){this.projectileCtx.fillStyle=M,this.projectileCtx.globalAlpha=1,this.projectileCtx.rect(0,0,this.VIEWPORT.x,this.VIEWPORT.y),this.projectileCtx.fill()}onMouseDown(t,e){}onMouseMove(t){}onMouseUp(t){}onMouseLeave(){}onTouchesChange(t){}}const rt=(i,t)=>{const e=[];for(let o=0;o<i.length;o++)e.push({id:i[o].identifier,x:i[o].clientX-t.x/2,y:i[o].clientY-t.y/2});return e},D=(i,t,e)=>{i.width=t.x*e,i.height=t.y*e,i.style.width=t.x+"px",i.style.height=t.y+"px"},F=(i,t)=>{const e=document.createElement("canvas"),o=e.getContext("2d");return e.width=i.width,e.height=i.height,o.scale(1/t,1/t),o.drawImage(i,0,0),e},ct=(i,t,e)=>{const[o,s,n]=B(i),[a,r,p]=B(t);return"#"+Math.round(a*e+o*(1-e)).toString(16)+Math.round(r*e+s*(1-e)).toString(16)+Math.round(p*e+n*(1-e)).toString(16)},B=i=>{const[t,e,o,s,n,a,r]=i;return[parseInt(e+o,16),parseInt(s+n,16),parseInt(a+r,16)]};const y=new lt;let v=0,f=new j[v](y.VIEWPORT);const I=new at(y.VIEWPORT);let w=!0;const G=()=>w=!w,U=()=>w,z=i=>{v=i,f=new j[i](y.VIEWPORT),y.updateCanvasFrame(0,f.list,I.list),q(y,f,U,G,H,S),S()},H=i=>{i==="increase"&&v<j.length-1&&z(v+1),i==="decrease"&&v>0&&z(v-1)},S=()=>(I.list=[],y.clear());q(y,f,U,G,H,S);let W=-1;const K=i=>{W<0&&(W=i);const t=(i-W)/1e3;W=i,w||(f.update(t),I.update(t,f.list),y.updateCanvasFrame(t,f.list,I.list)),window.requestAnimationFrame(K)};window.requestAnimationFrame(K);window.renderer=y;window.simulation=I;
